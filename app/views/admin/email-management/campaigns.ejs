
<!-- ========================================
     üìß TEMPLATE: Liste des Campagnes
     Fichier: app/views/admin/email-management/campaigns.ejs
     ======================================== -->

 <%- include('../../partials/navbarre.ejs') %>

<div class="admin-container">
    <div class="admin-header">
        <h1><i class="fas fa-list"></i> Campagnes Email</h1>
        <div class="admin-actions">
            <a href="/admin/email-management/campaigns/create" class="btn btn-primary">
                <i class="fas fa-plus"></i> Nouvelle Campagne
            </a>
        </div>
    </div>

    <!-- Filtres simples -->
    <div class="filters">
        <select id="statusFilter" onchange="filterCampaigns()">
            <option value="">Tous les statuts</option>
            <option value="draft">Brouillons</option>
            <option value="sent">Envoy√©es</option>
            <option value="scheduled">Programm√©es</option>
        </select>
        <input type="text" id="searchFilter" placeholder="Rechercher..." onkeyup="filterCampaigns()">
    </div>

    <!-- Liste des campagnes -->
    <div class="campaigns-list">
        <% if (campaigns.length === 0) { %>
            <div class="no-data">
                <i class="fas fa-envelope"></i>
                <h3>Aucune campagne</h3>
                <p>Cr√©ez votre premi√®re campagne email</p>
                <a href="/admin/email-management/campaigns/create" class="btn btn-primary">Cr√©er une campagne</a>
            </div>
        <% } else { %>
            <div class="campaigns-table">
                <div class="table-header">
                    <div>Nom</div>
                    <div>Sujet</div>
                    <div>Statut</div>
                    <div>Envoy√©s</div>
                    <div>Ouverture</div>
                    <div>Date</div>
                    <div>Actions</div>
                </div>
                <% campaigns.forEach(campaign => { %>
                    <div class="table-row" data-status="<%= campaign.status %>" data-name="<%= campaign.name.toLowerCase() %>">
                        <div class="campaign-name"><%= campaign.name %></div>
                        <div class="campaign-subject"><%= campaign.subject %></div>
                        <div>
                            <span class="status status-<%= campaign.status %>">
                                <%= campaign.status === 'draft' ? 'Brouillon' : 
                                    campaign.status === 'sent' ? 'Envoy√©e' :
                                    campaign.status === 'scheduled' ? 'Programm√©e' : campaign.status %>
                            </span>
                        </div>
                        <div><%= campaign.emails_sent || 0 %></div>
                        <div><%= campaign.open_rate || 0 %>%</div>
                        <div><%= helpers.formatDate(campaign.created_at) %></div>
                        <div class="actions">
                            <a href="/admin/email-management/campaigns/<%= campaign.id %>" class="btn btn-sm">Voir</a>
                            <% if (campaign.status === 'sent') { %>
                                <a href="/admin/email-management/campaigns/<%= campaign.id %>/stats" class="btn btn-sm btn-info">Stats</a>
                            <% } %>
                            <% if (campaign.status === 'draft') { %>
                                <a href="/admin/email-management/campaigns/<%= campaign.id %>/edit" class="btn btn-sm btn-primary">√âditer</a>
                            <% } %>
                            <button onclick="deleteCampaign(<%= campaign.id %>)" class="btn btn-sm btn-danger">Supprimer</button>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } %>
    </div>
</div>

<style>
.filters { display: flex; gap: 15px; margin-bottom: 20px; background: white; padding: 20px; border-radius: 8px; }
.filters select, .filters input { padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; }
.campaigns-table { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.table-header, .table-row { display: grid; grid-template-columns: 2fr 3fr 1fr 1fr 1fr 1.5fr 2fr; gap: 15px; padding: 15px; align-items: center; }
.table-header { background: #f8fafc; font-weight: 600; border-bottom: 1px solid #e2e8f0; }
.table-row { border-bottom: 1px solid #f1f5f9; }
.table-row:hover { background: #f8fafc; }
.status { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
.status-draft { background: #fef3c7; color: #92400e; }
.status-sent { background: #d1fae5; color: #047857; }
.status-scheduled { background: #ddd6fe; color: #7c3aed; }
.actions { display: flex; gap: 5px; }
.btn { padding: 6px 12px; border: none; border-radius: 4px; text-decoration: none; font-size: 12px; cursor: pointer; }
.btn-primary { background: #d89ab3; color: white; }
.btn-info { background: #3b82f6; color: white; }
.btn-danger { background: #ef4444; color: white; }
.btn-sm { padding: 4px 8px; }
.no-data { text-align: center; padding: 60px 20px; background: white; border-radius: 8px; }
</style>

<script>
function filterCampaigns() {
    const statusFilter = document.getElementById('statusFilter').value.toLowerCase();
    const searchFilter = document.getElementById('searchFilter').value.toLowerCase();
    const rows = document.querySelectorAll('.table-row');
    
    rows.forEach(row => {
        const status = row.dataset.status;
        const name = row.dataset.name;
        const statusMatch = !statusFilter || status === statusFilter;
        const searchMatch = !searchFilter || name.includes(searchFilter);
        row.style.display = (statusMatch && searchMatch) ? 'grid' : 'none';
    });
}

async function deleteCampaign(id) {
    if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette campagne ?')) return;
    
    try {
        const response = await fetch(`/admin/email-management/campaigns/${id}`, { method: 'DELETE' });
        const data = await response.json();
        if (data.success) location.reload();
        else alert('Erreur lors de la suppression');
    } catch (error) {
        alert('Erreur lors de la suppression');
    }
}
</script>

<%- include('../../partials/footer.ejs') %>


</body>
</html>