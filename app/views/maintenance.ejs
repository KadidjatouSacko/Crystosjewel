<!-- ==========================================
1. NOUVELLE PAGE MAINTENANCE.EJS - Couleurs rose-gold
========================================== -->

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --rose-gold: #b76e79;
            --rose-gold-light: #e8c2c8;
            --rose-gold-dark: #7d4b53;
            --cream: #fff8f0;
            --dark-text: #3a3a3a;
            --light-gray: #f5f5f5;
            --white-soft: #ffffff;
            --shadow-soft: 0 8px 30px rgba(183, 110, 121, 0.15);
            --shadow-strong: 0 15px 40px rgba(183, 110, 121, 0.25);
        }

        .maintenance-page {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--cream) 0%, var(--rose-gold-light) 30%, var(--rose-gold) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            color: var(--dark-text);
            position: relative;
            overflow: hidden;
        }

        /* Décoration d'arrière-plan */
        .maintenance-page::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
        }
        
        .maintenance-container {
            max-width: 700px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 50px;
            box-shadow: var(--shadow-strong);
            border: 1px solid rgba(183, 110, 121, 0.2);
            position: relative;
            z-index: 2;
        }
        
        .maintenance-icon {
            font-size: 90px;
            margin-bottom: 25px;
            color: var(--rose-gold);
            animation: pulse 2.5s ease-in-out infinite;
            filter: drop-shadow(0 5px 15px rgba(183, 110, 121, 0.3));
        }
        
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                opacity: 0.8;
            }
            50% { 
                transform: scale(1.15);
                opacity: 1;
            }
        }
        
        .maintenance-title {
            font-size: 3rem;
            margin-bottom: 20px;
            font-weight: 700;
            background: linear-gradient(45deg, var(--rose-gold), var(--rose-gold-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .maintenance-message {
            font-size: 1.3rem;
            margin-bottom: 35px;
            color: var(--dark-text);
            line-height: 1.7;
            opacity: 0.9;
        }
        
        .maintenance-time {
            background: linear-gradient(135deg, var(--rose-gold-light), rgba(255,255,255,0.8));
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
            font-weight: 600;
            border-left: 4px solid var(--rose-gold);
            box-shadow: var(--shadow-soft);
        }

        .maintenance-dates {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .date-info {
            flex: 1;
            background: rgba(183, 110, 121, 0.1);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(183, 110, 121, 0.2);
            min-width: 200px;
        }

        .date-label {
            font-size: 0.9rem;
            color: var(--rose-gold-dark);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .date-value {
            font-size: 1.1rem;
            color: var(--dark-text);
            font-weight: 500;
        }
        
        .admin-access {
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, var(--rose-gold-light), rgba(255,255,255,0.9));
            border-radius: 20px;
            border: 2px solid var(--rose-gold);
            box-shadow: var(--shadow-soft);
        }
        
        .admin-access h3 {
            margin-bottom: 15px;
            font-size: 1.4rem;
            color: var(--rose-gold-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .admin-access p {
            margin-bottom: 20px;
            color: var(--dark-text);
            opacity: 0.8;
        }
        
        .btn-admin-access {
            background: linear-gradient(135deg, var(--rose-gold), var(--rose-gold-dark));
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s ease;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(183, 110, 121, 0.3);
        }
        
        .btn-admin-access:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(183, 110, 121, 0.4);
            text-decoration: none;
            color: white;
            background: linear-gradient(135deg, var(--rose-gold-dark), var(--rose-gold));
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(183, 110, 121, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 30px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--rose-gold), var(--rose-gold-dark));
            width: 0%;
            border-radius: 4px;
            animation: progressAnimation 4s ease-in-out infinite;
        }
        
        @keyframes progressAnimation {
            0%, 100% { width: 15%; }
            50% { width: 85%; }
        }

        .maintenance-footer {
            margin-top: 30px;
            font-size: 14px;
            color: var(--dark-text);
            opacity: 0.7;
        }

        /* ===== COMPTEUR DE TEMPS ===== */
        .countdown-container {
            background: linear-gradient(135deg, rgba(183, 110, 121, 0.1), rgba(255,255,255,0.9));
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border: 2px solid var(--rose-gold-light);
            box-shadow: var(--shadow-soft);
        }

        .countdown-title {
            text-align: center;
            color: var(--rose-gold-dark);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .countdown-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .countdown-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 15px 12px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(183, 110, 121, 0.2);
            border: 1px solid var(--rose-gold-light);
            min-width: 70px;
        }

        .countdown-number {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--rose-gold-dark);
            line-height: 1;
            font-family: 'Courier New', monospace;
            text-shadow: 0 2px 4px rgba(183, 110, 121, 0.1);
        }

        .countdown-label {
            font-size: 0.8rem;
            color: var(--rose-gold);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 5px;
        }

        .countdown-separator {
            font-size: 2rem;
            color: var(--rose-gold);
            font-weight: bold;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .countdown-progress {
            width: 100%;
            height: 8px;
            background: rgba(183, 110, 121, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 15px;
        }

        .countdown-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--rose-gold), var(--rose-gold-dark));
            border-radius: 4px;
            transition: width 1s ease;
            box-shadow: 0 2px 8px rgba(183, 110, 121, 0.3);
        }

        .countdown-finished {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            animation: pulse-green 2s infinite;
        }

        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 5px 20px rgba(46, 204, 113, 0.3); }
            50% { box-shadow: 0 8px 30px rgba(46, 204, 113, 0.5); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .maintenance-container {
                padding: 30px 25px;
                margin: 20px;
            }
            
            .maintenance-title {
                font-size: 2.2rem;
            }
            
            .maintenance-message {
                font-size: 1.1rem;
            }

            .maintenance-dates {
                flex-direction: column;
            }

            .date-info {
                min-width: auto;
            }
            
            .countdown-display {
                flex-direction: column;
                gap: 15px;
            }

            .countdown-unit {
                min-width: 60px;
                padding: 12px 10px;
            }

            .countdown-number {
                font-size: 1.8rem;
            }

            .countdown-separator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="maintenance-page">
        <div class="maintenance-container">
            <div class="maintenance-icon">
                <i class="fas fa-tools"></i>
            </div>
            
            <h1 class="maintenance-title">Maintenance en cours</h1>
            
            <p class="maintenance-message">
                <%= message %>
            </p>
            
            <% if (startDate || endDate) { %>
            <div class="maintenance-dates">
                <% if (startDate) { %>
                <div class="date-info">
                    <div class="date-label">🕐 Début de maintenance</div>
                    <div class="date-value"><%= new Date(startDate).toLocaleString('fr-FR') %></div>
                </div>
                <% } %>
                
                <% if (endDate) { %>
                <div class="date-info">
                    <div class="date-label">🕑 Fin prévue</div>
                    <div class="date-value"><%= new Date(endDate).toLocaleString('fr-FR') %></div>
                </div>
                <% } %>
            </div>
            
            <!-- Compteur de temps restant -->
            <% if (endDate) { %>
            <div class="countdown-container">
                <h3 class="countdown-title">⏰ Temps restant</h3>
                <div class="countdown-display" id="countdown">
                    <div class="countdown-unit">
                        <span class="countdown-number" id="days">00</span>
                        <span class="countdown-label">Jours</span>
                    </div>
                    <div class="countdown-separator">:</div>
                    <div class="countdown-unit">
                        <span class="countdown-number" id="hours">00</span>
                        <span class="countdown-label">Heures</span>
                    </div>
                    <div class="countdown-separator">:</div>
                    <div class="countdown-unit">
                        <span class="countdown-number" id="minutes">00</span>
                        <span class="countdown-label">Minutes</span>
                    </div>
                    <div class="countdown-separator">:</div>
                    <div class="countdown-unit">
                        <span class="countdown-number" id="seconds">00</span>
                        <span class="countdown-label">Secondes</span>
                    </div>
                </div>
                <div class="countdown-progress">
                    <div class="countdown-progress-bar" id="progressBar"></div>
                </div>
            </div>
            <% } %>
            <% } %>
            
            <% if (estimatedDuration) { %>
            <div class="maintenance-time">
                <strong><i class="fas fa-clock"></i> Durée estimée :</strong> <%= estimatedDuration %>
            </div>
            <% } %>
            
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            
            <div class="maintenance-footer">
                Nous nous excusons pour la gêne occasionnée.<br>
                Le site sera de nouveau disponible très bientôt.
            </div>
            
            <!-- Section Admin -->
            <div class="admin-access">
                <% if (isAdmin) { %>
                    <h3><i class="fas fa-crown"></i> Vous êtes administrateur</h3>
                    <p>Vous pouvez accéder au site malgré la maintenance.</p>
                    <a href="/admin/stats" class="btn-admin-access">
                        <i class="fas fa-chart-line"></i> Dashboard Admin
                    </a>
                    <a href="/admin/parametres" class="btn-admin-access">
                        <i class="fas fa-cog"></i> Paramètres
                    </a>
                <% } else { %>
                    <h3><i class="fas fa-key"></i> Accès Administrateur</h3>
                    <p>Vous êtes administrateur ? Connectez-vous pour accéder au site.</p>
                    <a href="/connexion-inscription" class="btn-admin-access">
                        <i class="fas fa-sign-in-alt"></i> Se connecter
                    </a>
                <% } %>
            </div>
        </div>
    </div>
    
    <script>
        // ===== VARIABLES GLOBALES =====
        let endDate = null;
        let startDate = null;
        let countdownInterval = null;

        // ===== INITIALISATION =====
        document.addEventListener('DOMContentLoaded', function() {
            <% if (endDate) { %>
            endDate = new Date('<%= endDate %>');
            <% } %>
            
            <% if (startDate) { %>
            startDate = new Date('<%= startDate %>');
            <% } %>
            
            if (endDate) {
                startCountdown();
            }
        });

        // ===== FONCTION COMPTEUR =====
        function startCountdown() {
            updateCountdown(); // Mise à jour immédiate
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        function updateCountdown() {
            if (!endDate) return;

            const now = new Date().getTime();
            const distance = endDate.getTime() - now;

            // Si la maintenance est terminée
            if (distance < 0) {
                clearInterval(countdownInterval);
                showMaintenanceFinished();
                return;
            }

            // Calculs du temps
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Mise à jour de l'affichage
            document.getElementById('days').textContent = String(days).padStart(2, '0');
            document.getElementById('hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');

            // Barre de progression
            updateProgressBar(distance);
        }

        function updateProgressBar(timeRemaining) {
            if (!startDate || !endDate) return;

            const totalDuration = endDate.getTime() - startDate.getTime();
            const elapsed = Date.now() - startDate.getTime();
            const progress = Math.max(0, Math.min(100, (elapsed / totalDuration) * 100));
            
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
        }

        function showMaintenanceFinished() {
            const countdownContainer = document.querySelector('.countdown-container');
            if (countdownContainer) {
                countdownContainer.innerHTML = `
                    <div class="countdown-finished">
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px;"></i><br>
                        🎉 Maintenance terminée !<br>
                        <small>La page va se recharger automatiquement...</small>
                    </div>
                `;
                
                // Redirection automatique après 3 secondes
                setTimeout(() => {
                    window.location.href = '/';
                }, 3000);
            }
        }

        // Auto-refresh pour vérifier si la maintenance est terminée
        setInterval(() => {
            <% if (!isAdmin) { %>
            fetch('/api/maintenance/status')
                .then(response => response.json())
                .then(data => {
                    if (!data.status.active) {
                        window.location.href = '/';
                    }
                })
                .catch(() => {
                    // En cas d'erreur, recharger la page
                    window.location.reload();
                });
            <% } %>
        }, 15000); // Vérifier toutes les 15 secondes
    </script>
</body>
</html>

<!-- ==========================================
2. NOUVELLE SECTION MAINTENANCE DANS SETTINGS.EJS - Style rose-gold
========================================== -->

<!-- Section Maintenance - Version redesignée -->
<div class="section-card maintenance-card">
    <div class="section-header">
        <div class="section-icon">
            <i class="fas fa-tools"></i>
        </div>
        <div>
            <div class="section-title">Maintenance du Site</div>
            <div class="section-description">Gestion complète du mode maintenance</div>
        </div>
        <div id="maintenanceStatus" class="maintenance-status inactive">
            ✅ <strong>INACTIVE</strong>
        </div>
    </div>
    
    <form id="form-maintenance">
        <!-- Message de maintenance -->
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-comment"></i> Message de maintenance
            </label>
            <textarea class="form-textarea" id="maintenanceMessage" name="maintenanceMessage" 
                      rows="3" placeholder="Site temporairement indisponible pour maintenance. Nous reviendrons bientôt !"></textarea>
            <small class="help-text">Message affiché aux visiteurs pendant la maintenance</small>
        </div>
        
        <!-- Durée estimée -->
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-hourglass-half"></i> Durée estimée (optionnel)
            </label>
            <input type="text" class="form-input" id="estimatedDuration" name="estimatedDuration" 
                   placeholder="Ex: 30 minutes, 2 heures...">
            <small class="help-text">Estimation de la durée de maintenance</small>
        </div>

        <!-- Dates de début et fin -->
        <div class="date-range-group">
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-calendar-check"></i> Date de début
                </label>
                <input type="datetime-local" class="form-input" id="startDate" name="startDate">
                <small class="help-text">Date et heure de début de la maintenance</small>
            </div>
            
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-calendar-times"></i> Date de fin
                </label>
                <input type="datetime-local" class="form-input" id="endDate" name="endDate">
                <small class="help-text">Date et heure de fin prévue</small>
            </div>
        </div>
        
        <!-- Actions maintenance -->
        <div class="maintenance-actions">
            <div class="action-group immediate">
                <h4><i class="fas fa-bolt"></i> Maintenance Immédiate</h4>
                <p>Activer ou désactiver la maintenance instantanément</p>
                <div class="button-group">
                    <button type="button" id="activateMaintenanceBtn" class="btn btn-warning"
                            onclick="showConfirmModal('activate')">
                        <i class="fas fa-power-off"></i> Activer Maintenance
                    </button>
                    
                    <button type="button" id="deactivateMaintenanceBtn" class="btn btn-success" 
                            onclick="showConfirmModal('deactivate')" style="display: none;">
                        <i class="fas fa-check"></i> Désactiver Maintenance
                    </button>
                </div>
            </div>
            
            <div class="action-group scheduled">
                <h4><i class="fas fa-calendar-alt"></i> Maintenance Programmée</h4>
                <p>Programmer une maintenance pour plus tard</p>
                <div class="scheduled-form">
                    <div class="form-group">
                        <input type="datetime-local" class="form-input" id="scheduledTime" name="scheduledTime">
                    </div>
                    <button type="button" class="btn btn-info" onclick="showConfirmModal('schedule')">
                        <i class="fas fa-calendar-plus"></i> Programmer
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Modales de confirmation -->
<div id="confirmModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Confirmation</h3>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="modal-icon">
                <i id="modalIcon" class="fas fa-exclamation-triangle"></i>
            </div>
            <p id="modalMessage">Êtes-vous sûr ?</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Annuler</button>
            <button id="confirmBtn" class="btn btn-primary" onclick="confirmAction()">Confirmer</button>
        </div>
    </div>
</div>

<style>
/* ===== STYLES POUR LA SECTION MAINTENANCE ===== */
.maintenance-card {
    background: linear-gradient(135deg, var(--rose-gold-light) 0%, rgba(255,255,255,0.95) 100%);
    border: 2px solid var(--rose-gold);
    grid-column: 1 / -1;
    position: relative;
    overflow: hidden;
}

.maintenance-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--rose-gold), var(--rose-gold-dark));
}

.maintenance-card .section-icon {
    background: linear-gradient(135deg, var(--rose-gold), var(--rose-gold-dark));
    box-shadow: 0 5px 15px rgba(183, 110, 121, 0.3);
}

.maintenance-status {
    padding: 10px 18px;
    border-radius: 25px;
    font-size: 14px;
    font-weight: bold;
    text-align: center;
    min-width: 110px;
    margin-left: auto;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

.maintenance-status.active {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    animation: pulse-red 2s infinite;
}

.maintenance-status.inactive {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
}

@keyframes pulse-red {
    0%, 100% { box-shadow: 0 3px 10px rgba(231, 76, 60, 0.3); }
    50% { box-shadow: 0 5px 20px rgba(231, 76, 60, 0.5); }
}

.date-range-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 25px;
}

.maintenance-actions {
    margin-top: 30px;
}

.action-group {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 20px;
    border-left: 5px solid var(--rose-gold);
    box-shadow: 0 5px 15px rgba(183, 110, 121, 0.1);
    transition: all 0.3s ease;
}

.action-group:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(183, 110, 121, 0.15);
}

.action-group.immediate {
    border-left-color: #f39c12;
}

.action-group.scheduled {
    border-left-color: #3498db;
}

.action-group h4 {
    color: var(--rose-gold-dark);
    margin-bottom: 8px;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.action-group p {
    color: #666;
    margin-bottom: 18px;
    font-size: 0.95rem;
}

.button-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.scheduled-form {
    display: flex;
    gap: 15px;
    align-items: flex-end;
    flex-wrap: wrap;
}

.scheduled-form .form-group {
    flex: 1;
    min-width: 250px;
    margin-bottom: 0;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 0.95rem;
    text-decoration: none;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

.btn-warning {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
}

.btn-warning:hover {
    background: linear-gradient(135deg, #e67e22, #d35400);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
}

.btn-success {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    color: white;
}

.btn-success:hover {
    background: linear-gradient(135deg, #27ae60, #229954);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
}

.btn-info {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
}

.btn-info:hover {
    background: linear-gradient(135deg, #2980b9, #21618c);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

.help-text {
    color: #666;
    font-size: 0.85rem;
    margin-top: 5px;
    display: block;
}

/* ===== MODALES ===== */
.modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
}

.modal-content {
    background-color: white;
    margin: 15% auto;
    padding: 0;
    border-radius: 15px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    padding: 25px 25px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #eee;
}

.modal-header h3 {
    margin: 0;
    color: var(--rose-gold-dark);
    font-size: 1.3rem;
}

.close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
}

.close:hover {
    color: #000;
}

.modal-body {
    padding: 25px;
    text-align: center;
}

.modal-icon {
    font-size: 3rem;
    margin-bottom: 15px;
}

.modal-icon .fa-exclamation-triangle {
    color: #f39c12;
}

.modal-icon .fa-check-circle {
    color: #2ecc71;
}

.modal-icon .fa-power-off {
    color: #e74c3c;
}

.modal-body p {
    font-size: 1.1rem;
    color: #555;
    margin: 0;
}

.modal-footer {
    padding: 15px 25px 25px;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

.btn-primary {
    background: linear-gradient(135deg, var(--rose-gold), var(--rose-gold-dark));
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(135deg, var(--rose-gold-dark), var(--rose-gold));
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
    .date-range-group {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .scheduled-form {
        flex-direction: column;
        align-items: stretch;
    }
    
    .scheduled-form .form-group {
        min-width: auto;
    }
    
    .button-group {
        flex-direction: column;
    }
    
    .btn {
        justify-content: center;
        width: 100%;
    }

    .modal-content {
        margin: 20% auto;
        width: 95%;
    }
}</style>

<script>
// ===== GESTION DES MODALES ET CONFIRMATIONS =====
let currentAction = null;

function showConfirmModal(action) {
    currentAction = action;
    const modal = document.getElementById('confirmModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalMessage = document.getElementById('modalMessage');
    const modalIcon = document.getElementById('modalIcon');
    const confirmBtn = document.getElementById('confirmBtn');
    
    switch(action) {
        case 'activate':
            modalTitle.textContent = 'Activer la maintenance';
            modalMessage.innerHTML = '⚠️ <strong>Attention !</strong><br>Le site sera immédiatement inaccessible aux visiteurs.<br>Seuls les administrateurs pourront y accéder.';
            modalIcon.className = 'fas fa-power-off';
            confirmBtn.textContent = 'Activer';
            confirmBtn.className = 'btn btn-warning';
            break;
            
        case 'deactivate':
            modalTitle.textContent = 'Désactiver la maintenance';
            modalMessage.innerHTML = '✅ <strong>Confirmation</strong><br>Le site redeviendra accessible à tous les visiteurs.';
            modalIcon.className = 'fas fa-check-circle';
            confirmBtn.textContent = 'Désactiver';
            confirmBtn.className = 'btn btn-success';
            break;
            
        case 'schedule':
            const scheduledTime = document.getElementById('scheduledTime').value;
            if (!scheduledTime) {
                showNotification('⏰ Veuillez sélectionner une date et heure', 'error');
                return;
            }
            
            const scheduledDate = new Date(scheduledTime);
            if (scheduledDate <= new Date()) {
                showNotification('⏰ La date doit être dans le futur', 'error');
                return;
            }
            
            modalTitle.textContent = 'Programmer la maintenance';
            modalMessage.innerHTML = `📅 <strong>Confirmation</strong><br>La maintenance sera programmée pour :<br><strong>${scheduledDate.toLocaleString('fr-FR')}</strong>`;
            modalIcon.className = 'fas fa-calendar-alt';
            confirmBtn.textContent = 'Programmer';
            confirmBtn.className = 'btn btn-info';
            break;
    }
    
    modal.style.display = 'block';
}

function closeModal() {
    document.getElementById('confirmModal').style.display = 'none';
    currentAction = null;
}

function confirmAction() {
    closeModal();
    
    switch(currentAction) {
        case 'activate':
            MaintenanceManager.activate();
            break;
        case 'deactivate':
            MaintenanceManager.deactivate();
            break;
        case 'schedule':
            MaintenanceManager.schedule();
            break;
    }
}

// Fermer la modale en cliquant à l'extérieur
window.onclick = function(event) {
    const modal = document.getElementById('confirmModal');
    if (event.target == modal) {
        closeModal();
    }
}
</script>